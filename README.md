# Besthack'22 Финал

## Участники:
+ ### Ерхов Вадим Игоревич ([V4D1MECHE](https://github.com/V4D1MECHE)) (капитан)
+ ### Гунин Игорь Павлович ([notblank00](https://github.com/notblank00))
+ ### Касьяник Артемий Иванович ([Artemidividiy](https://github.com/Artemidividiy))
+ ### Ларшина Мария Андреевна ([larmari](https://github.com/larmari))

## Постановка задачи
Задача заключается в поиске и реализации методики преобразования данных об АЗС, и встриавании их в созданную нами базу данных.
Сложность задачи состоит в том, что мы не знаем, что получит наш микросервис, будь то запрос или файл. Также мы не можем быть уверены, что все поля входных данных будут соответствовать имеющимся в нашей таблице.

---
## Методика решения задачи.
Наше решение состоит в получии REST-API запроса от пользователя сервиса и его последующей обработке на [контроллере StationController](https://github.com/notblank00/besthack-22/blob/main/besthack22/src/main/java/ru/baza134/besthack22/controllers/StationController.java), мы получаем общую информацию о переданном файле или url-ссылке с запросом. 

После этого входной поток проходит через модуль [fetcher](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/fetchers). Если нам был передан url, то мы делаем из него, запрос и передаем ответ дальше [фабрике](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/factories), где определяются новые записи в базу данных.

## Структура входного файла (JSON)
```jsonc
{
    // Обязательные свойства:
  "fetchMode": "local",
    // local - файл с данными находится в файловой системе на сервере
    // remote - данные получаются по REST-запросу от удаленного хоста

  "dataSource": "/home/pyro/Downloads/azs.csv",
    // путь к файлу с данными или URL запроса к внешнему хосту для их получения

  "contentType": "json",
    // формат данных - на данный момент реализованы: json, csv, xml

  "CSVSeparator": "|",
    // поле необходимо только при выборе csv, в нем должен быть записан символ,
    // используемый в файле в качестве разделителя (важно: символ обязательно записан в литерале строки!).
    ...
}
```
Далее содержимое во многом зависит от формата. Для JSON маппинг полей указывается в следующем виде:
```json
{
    ...
    "station.name": "name",
    "station.address": "address"
    ...
}
```
Название свойства - название поля модели Station с префиксом `"station."`, значение - название соответствующего поля в потоке данных.

Для CSV вместо названий полей в потоке данных используются номера столбцов, индексируемые с нуля, однако каждое число должно быть записано в виде литерала строки:

```json
{
    ...
    "station.name": "2"
    ...
}
```
При обработке CSV первая строка

Также значения, такие как виды топлива и их стоимость могут быть записаны как JSON-строка в поле `FuelTypes` в формате массива объектов, содержащих название (код) вида топлива и его стоимость на данной заправочной станции. Это поле записывается как JSON-строка вне зависимости от указанного формата входных данных.

Значения контактных телефонов и адресов электронной почты могут повторяться в одной сущности, в таком случае к одной записи будет привязано несколько единиц контактной информации одного типа.
## Этапы разработки решения:
+ ### Первое, что нужно было сделать: определить форматы данных, с которыми мы можем работать. Мы решили использовать: json, xml, csv.
+ ### Вторым этапом мы создали необходимые [модели](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/models),  [Сервисы](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/services) и [репозитории](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/repositories) для нашей базы данны.
+ ### Третьим этапом мы реализовали бизнес-логику:
  + #### [fetcher](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/fetchers). Он парсит входные данные в строки.
  + #### [конверсионная фабрика](https://github.com/notblank00/besthack-22/tree/main/besthack22/src/main/java/ru/baza134/besthack22/factories). Получает из fetcher строки и решает, как их преобразовывать.
+ ### Начали покрывать проект тестами.
+ ### Последним этапом мы подготоивили [контроллер StationController](https://github.com/notblank00/besthack-22/blob/main/besthack22/src/main/java/ru/baza134/besthack22/controllers/StationController.java). Он преставляет собой входную точку в программу.

--- 
### Проблемы, с которыми мы столкнулись в процессе работы и их решения

---

# Вывод:
### Мы реализовали решение поставленной задачи, предусмотрев возможность расширения функционала за счет добавления дополнительных реализаций обработчиков данных различных форматов.